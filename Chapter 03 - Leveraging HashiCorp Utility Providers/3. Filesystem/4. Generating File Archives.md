# 4. Generating File Archives

Sometimes, it's necessary to package outputs from Terraform into compressed archives that you can use for several different purposes—such as efficiently transferring configuration to the next stage in the Application Deployment pipeline, bundling configuration for easy distribution to other external repositories, generating documentation or other artifacts that to track deployment history,  environmental changes or snapshots of configuration as they change over time.

You should avoid this approach when working with secrets or sensitive data, as more appropriate solutions exist for those scenarios. Metadata related to the infrastructure generated by Terraform needed by another tool in another format is the ideal scenario for this approach. 

The `archive_file` resource generates a ZIP file at the specified `output_path` and includes one or more files using either existing files or dynamically generated files.

## Including Existing Files

When you want to reference existing files that are either stored in your Terraform Module Directory or files generated by Terraform using the `local` Provider, you should use `source_file` or `source_dir` to include a single file or an entire directory of files within the archive, respectively.

```
	data "archive_file" "init" {
	  type        = "zip"
	  source_file = "${path.module}/foo.txt"
	  output_path = "${path.module}/files/out.zip"
	}
```

## Including Dynamically-Created Files

When you want to output content dynamically generated by Terraform using object construction in local variables or other means, you need to use one or more `source` blocks and specify the `content` and the `filename` of the file to include it within the archive. 

```
	data "archive_file" "dotfiles" {
	  type        = "zip"
	  output_path = "${path.module}/files/out.zip"
	
	  source {
	    content  = "foobar"
	    filename = "foo.txt"
	  }
	
	}
```

Optionally, if you only want one dynamically generated file in the archive, you can use the top-level `source_content` and `source_filename` to have a single file.

```
	data "archive_file" "dotfiles" {
	  type        = "zip"
	  output_path = "${path.module}/files/out.zip"
	
	  source_content          = "foobar"
	  source_content_filename = "foo.txt"
	
	}
```

The above examples produce the same output, but the latter is slightly more concise for the single-file archive scenario. At the same time, the former allows you to add as many files to the archive as you like using additional `source` blocks in the future.

It's important to note that each method for including files within the archive is mutually exclusive, so you must choose one—and only one—approach.